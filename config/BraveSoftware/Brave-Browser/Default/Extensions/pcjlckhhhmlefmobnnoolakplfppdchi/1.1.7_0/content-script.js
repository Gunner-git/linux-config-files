/*! For license information please see content-script.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,s)=>{for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{f:()=>A});const t="CHATGPT_CLOUDFLARE";class s extends Error{constructor(e,t){super(e),this.code=t}}const a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const r=new Uint8Array(16);function o(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));const c=function(e,t,s){if(a.randomUUID&&!t&&!e)return a.randomUUID();const n=(e=e||{}).random||(e.rng||o)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=n[e];return t}return function(e,t=0){return i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]}(n)};function d(){return c()}function u(e,t={}){return console.debug("proxyFetch",e,t),new Promise(((s,a)=>{const n=chrome.runtime.connect({name:d()});n.onDisconnect.addListener((()=>{a(new Error("Proxy fetch aborted: Connection closed"))})),n.postMessage({url:e,options:t,accessToken:"YOUR_ACCESS_TOKEN"}),n.onMessage.addListener((e=>{if("PROXY_RESPONSE_METADATA"===e.type){const{status:t,statusText:a,headers:n}=e.metadata,r=new Response(null,{status:t,statusText:a,headers:n});s(r)}else"PROXY_RESPONSE_BODY_CHUNK"===e.type?e.done&&n.disconnect():"PROXY_ERROR"===e.type&&(a(new Error(`Proxy fetch error: ${e.message}`)),n.disconnect())}))}))}const l=new class{fetch(e,t){return fetch(e,t)}},h=new class{async findExistingProxyTab(){const e=await(chrome?.tabs?.query({pinned:!0}));if(!e)return;const t=await Promise.all(e?.map((async e=>e.url?e.url:chrome.tabs.sendMessage(e.id,"url").catch((()=>{})))));for(let s=0;s<t.length;s++)if(t[s]?.startsWith("https://chat.openai.com"))return e[s]}waitForProxyTabReady(){return new Promise(((e,t)=>{const s=async function(t,n){if("PROXY_TAB_READY"===t.event)return console.debug("new proxy tab ready"),chrome.runtime.onMessage.removeListener(s),clearTimeout(a),e(n.tab),!0},a=setTimeout((()=>{chrome.runtime.onMessage.removeListener(s),t(new Error("Timeout waiting for ChatGPT tab"))}),1e4);chrome.runtime.onMessage.addListener(s)}))}async createProxyTab(){const e=this.waitForProxyTabReady();return chrome.tabs.create({url:"https://chat.openai.com",pinned:!0}),e}async getProxyTab(){let e=await this.findExistingProxyTab();return e||(e=await this.createProxyTab()),e}async refreshProxyTab(){const e=await this.findExistingProxyTab();if(!e)return void await this.createProxyTab();const t=this.waitForProxyTabReady();return chrome.tabs.reload(e.id),t}async fetch(e,t){const s=await this.getProxyTab(),a=await u(s.id,e);return 403===a.status?(await this.refreshProxyTab(),u(s.id,e)):a}},p=new class{async findExistingProxyTab(){const e=await(chrome?.tabs?.query({pinned:!0}));if(!e)return;const t=await Promise.all(e?.map((async e=>e.url?e.url:chrome.tabs.sendMessage(e.id,"url").catch((()=>{})))));for(let s=0;s<t.length;s++)if(t[s]?.startsWith("https://www.youtube.com"))return e[s]}waitForProxyTabReady(){return new Promise(((e,t)=>{const s=async function(t,n){if("PROXY_TAB_READY"===t.event)return console.debug("new proxy tab ready"),chrome.runtime.onMessage.removeListener(s),clearTimeout(a),e(n.tab),!0},a=setTimeout((()=>{chrome.runtime.onMessage.removeListener(s),t(new Error("Timeout waiting for Youtube tab"))}),1e4);chrome.runtime.onMessage.addListener(s)}))}async createProxyTab(){const e=this.waitForProxyTabReady();return chrome.tabs.create({url:"https://www.youtube.com",pinned:!0}),e}async getProxyTab(){let e=await this.findExistingProxyTab();return e||(e=await this.createProxyTab()),e}async refreshProxyTab(){const e=await this.findExistingProxyTab();if(!e)return void await this.createProxyTab();const t=this.waitForProxyTabReady();return chrome.tabs.reload(e.id),t}async fetch(e,t){const s=await this.getProxyTab(),a=await u(s.id,e);return 403===a.status?(await this.refreshProxyTab(),u(s.id,e)):a}};function m(e){chrome.storage.local.set({ChatGPTUser:e?JSON.stringify(e):null})}new class{constructor(){this.requester=l,h.findExistingProxyTab().then((e=>{e&&this.switchRequester(h)}))}switchRequester(e){console.debug("client switchRequester",e),this.requester=e}async fetch(e,t){return this.requester.fetch(e,t)}async getAccessToken(){const e=await this.fetch("https://chat.openai.com/api/auth/session");if(403===e.status)throw new s("Please pass Cloudflare check",t);const a=await e.json().catch((()=>({})));if(!a.accessToken)throw m(null),new s("There is no logged-in ChatGPT account in this browser.","CHATGPT_UNAUTHORIZED");return m(a),a.accessToken}async getClientSession(){const e=await this.fetch("https://chat.openai.com/api/auth/session");if(403===e.status)throw new s("Please pass Cloudflare check",t);const a=await e.json().catch((()=>({})));if(a.accessToken)return m(a),a;m(null)}async registerWebsocket(){const e=await this.getAccessToken(),t=await this.fetch("https://chat.openai.com/backend-api/register-websocket",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}),s=await t.json().catch((()=>({}))),a=s?.wss_url;var n;return n=a,new Promise((e=>{chrome.storage.local.set({wssUrl:n},(()=>{e()}))})),a}async requestBackendAPIWithToken(e,t,s,a){return this.fetch(`https://chat.openai.com/backend-api${s}`,{method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:void 0===a?void 0:JSON.stringify(a)})}async getModels(e){return(await this.requestBackendAPIWithToken(e,"GET","/models").then((e=>e.json()))).models}async generateChatTitle(e,t,s){await this.requestBackendAPIWithToken(e,"POST",`/conversation/gen_title/${t}`,{message_id:s})}async fixAuthState(){this.requester===h?await h.refreshProxyTab():(await h.getProxyTab(),this.switchRequester(h))}},new class{constructor(){this.requester=l,p.findExistingProxyTab().then((e=>{e&&this.switchRequester(p)}))}switchRequester(e){console.debug("client switchRequester",e),this.requester=e}async fetch(e,t){return this.requester.fetch(e,t)}async getUserEmail(){const e=await this.fetch("https://www.youtube.com/getAccountSwitcherEndpoint");if(200!==e.status)return"";const t=await(e?.text()),s=t?.replace(")]}'","");if(!s)return"";const a=JSON.parse(s),n=a?.data?.actions;if(!n||0===n.length)return"";const r=n[0]?.getMultiPageMenuAction?.menu?.multiPageMenuRenderer?.sections;return r&&0!==r.length?r[0]?.accountSectionListRenderer?.header?.googleAccountHeaderRenderer?.email?.simpleText??"":""}async fixAuthState(){this.requester===p?await p.refreshProxyTab():(await p.getProxyTab(),this.switchRequester(p))}};const g="AdSpeedUpAdsSkipCount";chrome.i18n.getMessage("summarizeVideo"),chrome.i18n.getMessage("loading"),chrome.i18n.getMessage("getTimestamps"),chrome.i18n.getMessage("loading");const y="https://link.adspeedup.com/discord",f="https://link.adspeedup.com/feedback";chrome.i18n.getMessage("loading"),chrome.i18n.getMessage("askAway"),chrome.i18n.getMessage("summarizeVideo"),chrome.i18n.getMessage("getTimestamps"),chrome.i18n.getMessage("chatWithVideo");const b=chrome.i18n.getMessage("adsSkipped");chrome.i18n.getMessage("community"),chrome.i18n.getMessage("feedback"),chrome.i18n.getMessage("checking"),chrome.i18n.getMessage("signInToSummarize"),chrome.i18n.getMessage("aiFeatures");const w=chrome.i18n.getMessage("community"),x=chrome.i18n.getMessage("feedback");async function v(){const e=document.createElement("div");return e.appendChild(await async function(){const e=await new Promise((e=>{chrome.storage.local.get([g],(function(t){e(t[g])}))})),t=document.createElement("div");return t.id="adspeedupskippedads",t.className="as-relative as-group dark:as-bg-neutral-800 as-flex as-items-center as-gap-[5px] as-p-[9px_12px_8px] as-text-text as-text-[13px] as-font-bold as-border as-border-solid as-border-neutral-200 dark:as-border-neutral-800/50 as-rounded-xl",t.innerHTML=`<svg\n      class="as-fill-primary as-text-[18px]"\n      view-box="0 0 16 16"\n      height="1em"\n      width="1em"\n    >\n      <path\n        d="M15.5 3.5a.5.5 0 01.5.5v8a.5.5 0 01-1 0V8.752l-6.267 3.636c-.52.302-1.233-.043-1.233-.696v-2.94l-6.267 3.636C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696L7.5 7.248v-2.94c0-.653.713-.998 1.233-.696L15 7.248V4a.5.5 0 01.5-.5zM1 4.633v6.734L6.804 8 1 4.633zm7.5 0v6.734L14.304 8 8.5 4.633z"\n      />\n    </svg>\n    <div id="adspeedupskippedadsvalue" class="as-text-primary">\n      ${e||0}\n    </div>\n    <span\n      class="as-invisible as-absolute as-w-max as-text-center as-top-10 -as-left-[100px] as-rounded as-shadow-lg as-p-1 as-text-xs as-font-normal as-bg-neutral-500/90 dark:as-bg-neutral-700/90 as-text-white -as-mt-8 group-hover:as-visible group-hover:as-z-50"\n      >${b}</span\n    > `,t}()),e.appendChild(function(){const e=document.createElement("div");return e.innerHTML=`<div class="as-mt-1">\n      <a\n        href=${y}\n        target="_blank"\n        class="dark:as-bg-neutral-800 as-flex as-items-center as-gap-[5px] as-text-text as-no-underline as-p-[8px_12px] as-text-[13px] as-font-bold as-rounded-lg hover:as-bg-gray-hover as-transition"\n      >\n        <svg\n          class="as-text-text as-fill-text as-text-[18px]"\n          viewBox="0 0 15 15"\n          height="1em"\n          width="1em"\n        >\n          <path\n            fill-rule="evenodd"\n            d="M5.075 1.826a.48.48 0 00-.127-.003c-.841.091-2.121.545-2.877.955a.48.48 0 00-.132.106c-.314.359-.599.944-.822 1.498C.887 4.95.697 5.55.59 5.984.236 7.394.043 9.087.017 10.693a.48.48 0 00.056.23c.3.573.947 1.104 1.595 1.492.655.393 1.42.703 2.036.763a.48.48 0 00.399-.153c.154-.167.416-.557.614-.86.09-.138.175-.27.241-.375.662.12 1.492.19 2.542.19 1.048 0 1.878-.07 2.54-.19.066.106.15.237.24.374.198.304.46.694.615.861a.48.48 0 00.399.153c.616-.06 1.38-.37 2.035-.763.648-.388 1.295-.919 1.596-1.492a.48.48 0 00.055-.23c-.025-1.606-.219-3.3-.571-4.71a12.98 12.98 0 00-.529-1.601c-.223-.554-.508-1.14-.821-1.498a.48.48 0 00-.133-.106c-.755-.41-2.035-.864-2.877-.955a.48.48 0 00-.126.003 1.18 1.18 0 00-.515.238 2.905 2.905 0 00-.794.999A14.046 14.046 0 007.5 3.02c-.402 0-.774.015-1.117.042a2.905 2.905 0 00-.794-.998 1.18 1.18 0 00-.514-.238zm5.943 9.712a23.136 23.136 0 00.433.643c.396-.09.901-.3 1.385-.59.543-.325.974-.7 1.182-1.017-.033-1.506-.219-3.07-.54-4.358a12.046 12.046 0 00-.488-1.475c-.2-.498-.415-.92-.602-1.162-.65-.337-1.675-.693-2.343-.79a.603.603 0 00-.058.04 1.5 1.5 0 00-.226.22c-.041.05-.08.098-.113.145.305.056.577.123.818.197.684.21 1.177.5 1.418.821a.48.48 0 11-.768.576c-.059-.078-.316-.29-.932-.48-.595-.182-1.47-.328-2.684-.328-1.214 0-2.09.146-2.684.329-.616.19-.873.4-.932.479a.48.48 0 11-.768-.576c.241-.322.734-.61 1.418-.82.24-.075.512-.141.816-.197a2.213 2.213 0 00-.114-.146 1.5 1.5 0 00-.225-.22.604.604 0 00-.059-.04c-.667.097-1.692.453-2.342.79-.188.243-.402.664-.603 1.162-.213.53-.39 1.087-.487 1.475-.322 1.288-.508 2.852-.54 4.358.208.318.638.692 1.181 1.018.485.29.989.5 1.386.589a16.32 16.32 0 00.433-.643c-.785-.279-1.206-.662-1.48-1.072a.48.48 0 01.8-.532c.26.392.944 1.086 4.2 1.086 3.257 0 3.94-.694 4.2-1.086a.48.48 0 01.8.532c-.274.41-.696.794-1.482 1.072zM4.08 7.012c.244-.262.575-.41.92-.412.345.002.676.15.92.412.243.263.38.618.38.988s-.137.725-.38.988c-.244.262-.575.41-.92.412a1.263 1.263 0 01-.92-.412A1.453 1.453 0 013.7 8c0-.37.137-.725.38-.988zM10 6.6c-.345.002-.676.15-.92.412-.243.263-.38.618-.38.988s.137.725.38.988c.244.262.575.41.92.412.345-.002.676-.15.92-.412.243-.263.38-.618.38-.988s-.137-.725-.38-.988a1.263 1.263 0 00-.92-.412z"\n            clip-rule="evenodd"\n          />\n        </svg>\n        <div class="as-mt-[1.5px] as-font-medium">${w}</div>\n      </a>\n    </div>\n    <div class="as-mt-1">\n      <a\n        href=${f}\n        target="_blank"\n        class="dark:as-bg-neutral-800 as-flex as-items-center as-gap-[5px] as-text-text as-no-underline as-p-[8px_12px] as-text-[13px] as-font-bold as-rounded-xl hover:as-bg-gray-hover as-transition"\n      >\n        <svg\n          class="as-text-text as-fill-text as-text-[18px]"\n          viewBox="0 0 24 24"\n          height="1em"\n          width="1em"\n        >\n          <path fill="none" d="M0 0h24v24H0z" />\n          <path\n            d="M6.455 19L2 22.5V4a1 1 0 011-1h18a1 1 0 011 1v14a1 1 0 01-1 1H6.455zM4 18.385L5.763 17H20V5H4v13.385zM11 13h2v2h-2v-2zm0-6h2v5h-2V7z"\n          />\n        </svg>\n        <div class="as-mt-[1.5px] as-font-medium">${x}</div>\n      </a>\n    </div>`,e}()),e}async function T(){const e=document.createElement("div");return e.id="AdSpeedUpOverlay",e.className="as-fixed as-top-0 as-left-0 as-w-screen as-h-screen as-z-[5000]",e.style.display="none",e.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(await async function(){const e=document.createElement("div");return e.className="as-w-60 as-absolute as-top-2 as-right-10 as-animate-slide-in-right",e.addEventListener("click",(e=>{e.stopPropagation()})),e.appendChild(await async function(){const e=document.createElement("div");return e.id="AdSpeedUpAIFeatures",e.className="as-p-5 as-bg-background as-text-text as-text-base as-border as-border-solid as-border-neutral-400 as-rounded-[30px] as-shadow-lg",e.appendChild(function(){const e=document.createElement("div");e.className="as-flex as-items-center as-gap-1 as-mb-4 as-text-xl as-font-bold";const t=chrome.runtime.getURL("icons/icon16.png");return e.innerHTML=`<img\n      src="${t}"\n      class="as-w-10 as-aspect-square as-rounded-full"\n    />\n    <div>Ad Speedup</div>`,e}()),e.appendChild(await v()),e}()),e}()),e}let P=!1;let k=!1;let E="";function A(){return E}!function(){if(document.querySelector("#AdSpeedUpStyle"))return;const e=document.createElement("link");e.id="AdSpeedUpStyle",e.href=chrome.runtime.getURL("styles/main.css"),e.rel="stylesheet",document.head.appendChild(e)}(),async function e(){if(P)return;P=!0;const t=document.querySelector("body");if(!t)return P=!1,setTimeout(e,1e3);document.getElementById("AdSpeedUpOverlay")||t.appendChild(await T()),P=!1}(),chrome.runtime.onMessage.addListener((async(e,t,s)=>{const{type:a,tabUrl:n,text:r,chatId:o,captions:i,isTabActive:c}=e;switch(a){case"ADSPEEDUP":default:break;case"PREPARE_YOUTUBE_WATCH":E=n,function(){function e(e){const t=[".ytp-ad-skip-button",".ytp-ad-skip-button-modern",".ytp-ad-overlay-close-button",".ytp-skip-ad-button",".ytp-skip-ad-button-modern"];for(const s of t){const t=e?.querySelectorAll(s);for(const e of t)e?.click()}}function t(e,t){const s=e.querySelector("video");if(s&&t){s.playbackRate=16,s.muted=!0;const e="AdSpeedUpAdsSkipCount";k||(k=!0,chrome.storage.local.get([e],(function(t){const s=t[e],a=Number(s??0)+1;chrome.storage.local.set({[e]:a});const n=document.getElementById("adspeedupskippedadsvalue");n&&(n.innerText=a)})),async function(){const e=await new Promise((e=>{chrome.storage.local.get("deviceId",(t=>{let s=t.deviceId;s?e(s):(s="device_"+d(),chrome.storage.local.set({deviceId:s},(()=>{e(s)})))}))}));fetch("https://prod-backend.adspeedup.com/api/v1/owner/incrementAdsSkipCount",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:e})})}().then((()=>{})),setTimeout((()=>{k=!1}),1e4))}}function s(s,a){for(const a of s)if("attributes"===a.type&&"class"===a.attributeName){const s=a.target,n=s?.querySelector("#movie_player .video-ads"),r=(s.classList.contains("ad-showing")||s.classList.contains("ad-interrupting"))&&n?.childElementCount>0;t(s,r),r&&e(s)}}!function a(){const n=document.querySelector("#movie_player");if(n){new MutationObserver(s).observe(n,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["class"]});const a=n?.querySelector("#movie_player .video-ads"),r=(n.classList.contains("ad-showing")||n.classList.contains("ad-interrupting"))&&a?.childElementCount>0;t(n,r),e(n)}else setTimeout(a,50)}()}();break;case"SHOW_OVERLAY":!function(){const e=document.getElementById("AdSpeedUpOverlay");e.style.display="none"===e.style.display?"block":"none"}()}}))})();